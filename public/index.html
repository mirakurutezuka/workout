<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#111111">
<title>ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆãƒˆãƒ©ãƒƒã‚«ãƒ¼</title>
<link rel="manifest" href="./manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700;900&display=swap" rel="stylesheet">
<style>
  *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{background:#111;overflow-x:hidden;font-family:'Noto Sans JP',-apple-system,sans-serif}
  input,textarea,button{font-family:inherit}
  ::-webkit-scrollbar{display:none}
  textarea{resize:vertical}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
</style>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useMemo,useCallback,useRef}=React;

/* â”€â”€ Server API â”€â”€ */
const API = window.location.origin;
const api = {
  async getUsers(){ try{ const r=await fetch(`${API}/api/users`); return r.json() }catch{ return null }},
  async addUser(name){ try{ const r=await fetch(`${API}/api/users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name})}); return r.json() }catch{ return null }},
  async getMenus(user){ try{ const r=await fetch(`${API}/api/menus/${user}`); return r.json() }catch{ return null }},
  async saveMenus(user,menus){ try{ await fetch(`${API}/api/menus/${user}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({menus})}); return true }catch{ return false }},
  async saveMenuTab(user,tab,exercises){ try{ await fetch(`${API}/api/menus/${user}/${tab}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({exercises})}); return true }catch{ return false }},
  async getComments(user){ try{ const r=await fetch(`${API}/api/comments/${user}`); return r.json() }catch{ return null }},
  async addComment(user,key,author,text){ try{ const r=await fetch(`${API}/api/comments/${user}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key,author,text})}); return r.json() }catch{ return null }},
  async sync(user){ try{ const r=await fetch(`${API}/api/sync/${user}`); return r.json() }catch{ return null }},
  async getMeasurements(user){ try{ const r=await fetch(`${API}/api/measurements/${user}`); return await r.json() }catch{ return null }},
  async saveMeasurement(user,data){ try{ const r=await fetch(`${API}/api/measurements/${user}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}); return await r.json() }catch{ return null }},
  async deleteMeasurement(user,date){ try{ const r=await fetch(`${API}/api/measurements/${user}/${encodeURIComponent(date)}`,{method:"DELETE"}); return await r.json() }catch{ return null }},
};

/* â”€â”€ Constants â”€â”€ */
const BODY_PARTS=["èƒ¸","èƒŒä¸­","è‚©","è…•","è„š"];
const BODY_COLORS={
  èƒ¸:{bg:"#F9E8E8",text:"#A04040",accent:"#D46A6A",border:"#E8C0C0",dot:"#E85555"},
  èƒŒä¸­:{bg:"#E4EAF4",text:"#3A5080",accent:"#5B7DB8",border:"#C0CCE0",dot:"#5588DD"},
  è‚©:{bg:"#E4F2E8",text:"#2E6E3E",accent:"#4FA06A",border:"#B8D8C4",dot:"#44BB66"},
  è…•:{bg:"#F4EEE4",text:"#7A5C30",accent:"#B8903C",border:"#DDD0B8",dot:"#DDAA33"},
  è„š:{bg:"#ECE4F4",text:"#5A3A80",accent:"#8A60C0",border:"#D0C0E0",dot:"#9966DD"},
};
const EXERCISES={
  èƒ¸:["ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹","ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹","ãƒ‡ã‚¯ãƒ©ã‚¤ãƒ³ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹","ã‚¯ãƒ­ãƒ¼ã‚ºã‚°ãƒªãƒƒãƒ—ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹","ãƒ•ãƒ­ã‚¢ãƒ—ãƒ¬ã‚¹","ã‚¹ãƒŸã‚¹ãƒã‚·ãƒ³ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹","ã‚¹ãƒŸã‚¹ãƒã‚·ãƒ³ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¹","ãƒ€ãƒ³ãƒ™ãƒ«ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹","ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³DBãƒ—ãƒ¬ã‚¹","ãƒã‚¤ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³DBãƒ—ãƒ¬ã‚¹","ãƒ‡ã‚¯ãƒ©ã‚¤ãƒ³DBãƒ—ãƒ¬ã‚¹","ãƒ€ãƒ³ãƒ™ãƒ«ãƒ•ãƒ©ã‚¤","ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³DBãƒ•ãƒ©ã‚¤","ãƒ‡ã‚¯ãƒ©ã‚¤ãƒ³DBãƒ•ãƒ©ã‚¤","ãƒ€ãƒ³ãƒ™ãƒ«ãƒ—ãƒ«ã‚ªãƒ¼ãƒãƒ¼","ãƒã‚§ã‚¹ãƒˆãƒ—ãƒ¬ã‚¹","ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ»ãƒã‚§ã‚¹ãƒˆãƒ—ãƒ¬ã‚¹","ãƒã‚·ãƒ³ãƒã‚§ã‚¹ãƒˆãƒ—ãƒ¬ã‚¹","ãƒšãƒƒã‚¯ãƒ•ãƒ©ã‚¤ï¼ˆãƒã‚·ãƒ³ï¼‰","ãƒšãƒƒã‚¯ãƒ‡ãƒƒã‚¯","ã‚±ãƒ¼ãƒ–ãƒ«ã‚¯ãƒ­ã‚¹ã‚ªãƒ¼ãƒãƒ¼","ã‚±ãƒ¼ãƒ–ãƒ«ãƒ•ãƒ©ã‚¤","ãƒ‡ã‚£ãƒƒãƒ—ã‚¹","ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—","ãƒ¯ã‚¤ãƒ‰ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—","ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—"],
  èƒŒä¸­:["ãƒ™ãƒ³ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼","ãƒšãƒ³ãƒ‰ãƒ¬ã‚¤ãƒ­ãƒ¼","Tãƒãƒ¼ãƒ­ãƒ¼","ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ","ãƒ©ãƒƒã‚¯ãƒ—ãƒ«","ãƒ€ãƒ³ãƒ™ãƒ«ãƒ­ãƒ¼ï¼ˆãƒ¯ãƒ³ãƒãƒ³ãƒ‰ï¼‰","ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³DBãƒ­ãƒ¼","ãƒ€ãƒ³ãƒ™ãƒ«ãƒ—ãƒ«ã‚ªãƒ¼ãƒãƒ¼","ãƒã‚·ãƒ³ãƒ­ãƒ¼","ã‚·ãƒ¼ãƒ†ãƒƒãƒ‰ãƒ­ãƒ¼","ãƒ­ãƒ¼ãƒ—ãƒ¼ãƒªãƒ¼ãƒ­ãƒ¼","ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ï¼ˆãƒ¯ã‚¤ãƒ‰ï¼‰","ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ï¼ˆãƒŠãƒ­ãƒ¼ï¼‰","ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ï¼ˆãƒªãƒãƒ¼ã‚¹ï¼‰","ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã‚¢ãƒ¼ãƒ ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³","ã‚±ãƒ¼ãƒ–ãƒ«ãƒ­ãƒ¼","ãƒ•ã‚§ã‚¤ã‚¹ãƒ—ãƒ«","ãƒãƒ³ãƒ‹ãƒ³ã‚°ï¼ˆæ‡¸å‚ï¼‰","ãƒ¯ã‚¤ãƒ‰ãƒãƒ³ãƒ‹ãƒ³ã‚°","ãƒŠãƒ­ãƒ¼ãƒãƒ³ãƒ‹ãƒ³ã‚°","ã‚¤ãƒ³ãƒãƒ¼ãƒ†ãƒƒãƒ‰ãƒ­ãƒ¼","ä¸ŠèƒŒéƒ¨ç‹™ã„ã®ãƒ­ãƒ¼","ãƒãƒ³ãƒ‰ãƒ—ãƒ«ã‚¢ãƒ‘ãƒ¼ãƒˆ"],
  è‚©:["ãƒãƒ¼ãƒ™ãƒ«ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹","ãƒ€ãƒ³ãƒ™ãƒ«ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹","ã‚¢ãƒ¼ãƒãƒ«ãƒ‰ãƒ—ãƒ¬ã‚¹","ã‚¹ãƒŸã‚¹ãƒã‚·ãƒ³ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹","ãƒã‚·ãƒ³ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹","ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹ï¼ˆæ‰‹å¹…ç‹­ã‚ï¼‰","DBã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º","ã‚±ãƒ¼ãƒ–ãƒ«ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º","ãƒã‚·ãƒ³ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º","ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º","ã‚¢ãƒƒãƒ—ãƒ©ã‚¤ãƒˆãƒ­ãƒ¼","ã‚±ãƒ¼ãƒ–ãƒ«ã‚¢ãƒƒãƒ—ãƒ©ã‚¤ãƒˆãƒ­ãƒ¼","ãƒ•ãƒ­ãƒ³ãƒˆãƒ¬ã‚¤ã‚ºï¼ˆDBï¼‰","ãƒ•ãƒ­ãƒ³ãƒˆãƒ¬ã‚¤ã‚ºï¼ˆãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰","ã‚±ãƒ¼ãƒ–ãƒ«ãƒ•ãƒ­ãƒ³ãƒˆãƒ¬ã‚¤ã‚º","ã‚±ãƒ¼ãƒ–ãƒ«ãƒªã‚¢ãƒ¬ã‚¤ã‚º","ãƒã‚·ãƒ³ãƒªã‚¢ãƒ¬ã‚¤ã‚º","ãƒªã‚¢ãƒ‡ãƒ«ãƒˆãƒ•ãƒ©ã‚¤ï¼ˆDBï¼‰","ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒªã‚¢ãƒ¬ã‚¤ã‚º","ãƒ•ã‚§ã‚¤ã‚¹ãƒ—ãƒ«","ãƒªãƒãƒ¼ã‚¹ãƒšãƒƒã‚¯ãƒ‡ãƒƒã‚¯","ãƒãƒ¼ãƒ™ãƒ«ã‚·ãƒ¥ãƒ©ãƒƒã‚°","ãƒ€ãƒ³ãƒ™ãƒ«ã‚·ãƒ¥ãƒ©ãƒƒã‚°"],
  è…•:["ã‚±ãƒ¼ãƒ–ãƒ«ãƒ—ãƒ¬ã‚¹ãƒ€ã‚¦ãƒ³","ã‚±ãƒ¼ãƒ–ãƒ«ãƒ—ãƒ¬ã‚¹ãƒ€ã‚¦ãƒ³ï¼ˆãƒ­ãƒ¼ãƒ—ï¼‰","ã‚±ãƒ¼ãƒ–ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰EXT","EZãƒãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰EXT","ãƒ€ãƒ³ãƒ™ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰EXT","ã‚¹ã‚«ãƒ«ã‚¯ãƒ©ãƒƒã‚·ãƒ£ãƒ¼","ãƒ©ã‚¤ã‚¤ãƒ³ã‚°ãƒˆãƒ©ã‚¤ã‚»ãƒ—ã‚¹EXT","ã‚­ãƒƒã‚¯ãƒãƒƒã‚¯ï¼ˆDBï¼‰","ãƒ‡ã‚£ãƒƒãƒ—ã‚¹ï¼ˆä¸‰é ­ç­‹ï¼‰","ãƒ™ãƒ³ãƒãƒ‡ã‚£ãƒƒãƒ—ã‚¹","ãƒŠãƒ­ãƒ¼ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹","ãƒã‚·ãƒ³ãƒˆãƒ©ã‚¤ã‚»ãƒ—ã‚¹EXT","ãƒãƒ¼ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«","EZãƒãƒ¼ã‚«ãƒ¼ãƒ«","ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«","ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³DBã‚«ãƒ¼ãƒ«","ã‚³ãƒ³ã‚»ãƒ³ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ«","ãƒãƒ³ãƒãƒ¼ã‚«ãƒ¼ãƒ«","ãƒ—ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚«ãƒ¼ãƒ«ï¼ˆEZï¼‰","ãƒ—ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚«ãƒ¼ãƒ«ï¼ˆDBï¼‰","ãƒã‚·ãƒ³ãƒ—ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚«ãƒ¼ãƒ«","ã‚±ãƒ¼ãƒ–ãƒ«ã‚«ãƒ¼ãƒ«","ã‚±ãƒ¼ãƒ–ãƒ«ãƒãƒ³ãƒãƒ¼ã‚«ãƒ¼ãƒ«","ãƒªãƒãƒ¼ã‚¹ã‚«ãƒ¼ãƒ«","ã‚¹ãƒ‘ã‚¤ãƒ€ãƒ¼ã‚«ãƒ¼ãƒ«","ãƒ‰ãƒ©ãƒƒã‚°ã‚«ãƒ¼ãƒ«","ã‚¾ãƒƒãƒˆãƒãƒ³ã‚«ãƒ¼ãƒ«","ãƒªã‚¹ãƒˆã‚«ãƒ¼ãƒ«","ãƒªãƒãƒ¼ã‚¹ãƒªã‚¹ãƒˆã‚«ãƒ¼ãƒ«"],
  è„š:["ãƒãƒ¼ãƒ™ãƒ«ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ","ãƒ•ãƒ­ãƒ³ãƒˆã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ","ã‚´ãƒ–ãƒ¬ãƒƒãƒˆã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ","ã‚¹ãƒŸã‚¹ãƒã‚·ãƒ³ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ","ãƒãƒƒã‚¯ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ","Vã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ","ãƒ–ãƒ«ã‚¬ãƒªã‚¢ãƒ³ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ","ã‚¹ãƒ—ãƒªãƒƒãƒˆã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ","ãƒ©ãƒ³ã‚¸ï¼ˆå‰æ–¹ï¼‰","ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°ãƒ©ãƒ³ã‚¸","ãƒªãƒãƒ¼ã‚¹ãƒ©ãƒ³ã‚¸","ã‚µã‚¤ãƒ‰ãƒ©ãƒ³ã‚¸","ã‚¹ãƒ†ãƒƒãƒ—ã‚¢ãƒƒãƒ—","ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹","ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹ï¼ˆãƒŠãƒ­ãƒ¼ï¼‰","ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹ï¼ˆãƒ¯ã‚¤ãƒ‰ï¼‰","ã‚·ãƒ³ã‚°ãƒ«ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹","ãƒ¬ãƒƒã‚°ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³","ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ«ï¼ˆãƒ©ã‚¤ã‚¤ãƒ³ã‚°ï¼‰","ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ«ï¼ˆã‚·ãƒ¼ãƒ†ãƒƒãƒ‰ï¼‰","ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ","ãƒ«ãƒ¼ãƒãƒ‹ã‚¢ãƒ³ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ","ãƒ€ãƒ³ãƒ™ãƒ«ãƒ«ãƒ¼ãƒãƒ‹ã‚¢ãƒ³ãƒ‡ãƒƒãƒ‰","ã‚¹ãƒ†ã‚£ãƒ•ãƒ¬ãƒƒã‚°ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ","ã‚·ãƒ³ã‚°ãƒ«ãƒ¬ãƒƒã‚°RDL","ãƒ’ãƒƒãƒ—ã‚¹ãƒ©ã‚¹ãƒˆ","ãƒãƒ¼ãƒ™ãƒ«ãƒ’ãƒƒãƒ—ã‚¹ãƒ©ã‚¹ãƒˆ","ãƒ€ãƒ³ãƒ™ãƒ«ãƒ’ãƒƒãƒ—ã‚¹ãƒ©ã‚¹ãƒˆ","ã‚°ãƒ«ãƒ¼ãƒˆãƒ–ãƒªãƒƒã‚¸","ã‚¢ãƒ€ã‚¯ã‚¿ãƒ¼ï¼ˆãƒã‚·ãƒ³ï¼‰","ã‚¢ãƒ–ãƒ€ã‚¯ã‚¿ãƒ¼ï¼ˆãƒã‚·ãƒ³ï¼‰","ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ•ãƒ¬ã‚¤ã‚º","ã‚·ãƒ¼ãƒ†ãƒƒãƒ‰ã‚«ãƒ¼ãƒ•ãƒ¬ã‚¤ã‚º","ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ•ãƒ¬ã‚¤ã‚º"],
};
const DEFAULT_MENUS={
  Push:[{body:"èƒ¸",name:"ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ»ãƒã‚§ã‚¹ãƒˆãƒ—ãƒ¬ã‚¹",alt:"",sets:1,repRange:"5ï½7",records:[]},{body:"èƒ¸",name:"ãƒ‡ã‚£ãƒƒãƒ—ã‚¹",alt:"ãƒ¯ã‚¤ãƒ‰ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—",sets:2,repRange:"5ï½7",records:[]},{body:"è‚©",name:"ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹ï¼ˆæ‰‹å¹…ç‹­ã‚ï¼‰",alt:"ãƒ€ãƒ³ãƒ™ãƒ«ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹",sets:2,repRange:"5ï½7",records:[]},{body:"èƒ¸",name:"ãƒã‚·ãƒ³ãƒã‚§ã‚¹ãƒˆãƒ—ãƒ¬ã‚¹",alt:"ãƒ€ãƒ³ãƒ™ãƒ«ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹",sets:2,repRange:"7ï½9",records:[]},{body:"èƒ¸",name:"ãƒšãƒƒã‚¯ãƒ•ãƒ©ã‚¤ï¼ˆãƒã‚·ãƒ³ï¼‰",alt:"ãƒ€ãƒ³ãƒ™ãƒ«ãƒ•ãƒ©ã‚¤",sets:2,repRange:"9ï½11",records:[]},{body:"è…•",name:"ã‚±ãƒ¼ãƒ–ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰EXT",alt:"ãƒ€ãƒ³ãƒ™ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰EXT",sets:2,repRange:"7ï½9",records:[]},{body:"è…•",name:"ã‚±ãƒ¼ãƒ–ãƒ«ãƒ—ãƒ¬ã‚¹ãƒ€ã‚¦ãƒ³",alt:"ãƒ™ãƒ³ãƒãƒ‡ã‚£ãƒƒãƒ—ã‚¹",sets:2,repRange:"5ï½7",records:[]}],
  Pull:[{body:"èƒŒä¸­",name:"ãƒ™ãƒ³ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼",alt:"",sets:1,repRange:"5ï½7",records:[]},{body:"èƒŒä¸­",name:"ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ï¼ˆãƒŠãƒ­ãƒ¼ï¼‰",alt:"ãƒŠãƒ­ãƒ¼ãƒãƒ³ãƒ‹ãƒ³ã‚°",sets:2,repRange:"7ï½9",records:[]},{body:"èƒŒä¸­",name:"ãƒã‚·ãƒ³ãƒ­ãƒ¼",alt:"ãƒ€ãƒ³ãƒ™ãƒ«ãƒ­ãƒ¼ï¼ˆãƒ¯ãƒ³ãƒãƒ³ãƒ‰ï¼‰",sets:2,repRange:"7ï½9",records:[]},{body:"èƒŒä¸­",name:"ä¸ŠèƒŒéƒ¨ç‹™ã„ã®ãƒ­ãƒ¼",alt:"ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³DBãƒ­ãƒ¼",sets:2,repRange:"8ï½10",records:[]},{body:"è‚©",name:"ã‚±ãƒ¼ãƒ–ãƒ«ãƒªã‚¢ãƒ¬ã‚¤ã‚º",alt:"ãƒªã‚¢ãƒ‡ãƒ«ãƒˆãƒ•ãƒ©ã‚¤ï¼ˆDBï¼‰",sets:2,repRange:"9ï½11",records:[]},{body:"è…•",name:"ãƒ—ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚«ãƒ¼ãƒ«ï¼ˆEZï¼‰",alt:"ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«",sets:2,repRange:"8ï½10",records:[]},{body:"è…•",name:"ãƒãƒ³ãƒãƒ¼ã‚«ãƒ¼ãƒ«",alt:"",sets:1,repRange:"9ï½11",records:[]}],
  Leg:[{body:"è„š",name:"ãƒãƒƒã‚¯ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ",alt:"ã‚´ãƒ–ãƒ¬ãƒƒãƒˆã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ",sets:1,repRange:"5ï½7",records:[]},{body:"è„š",name:"ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹",alt:"ãƒ–ãƒ«ã‚¬ãƒªã‚¢ãƒ³ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ",sets:2,repRange:"6ï½8",records:[]},{body:"è„š",name:"ãƒ¬ãƒƒã‚°ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³",alt:"",sets:2,repRange:"7ï½9",records:[]},{body:"è„š",name:"ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ«ï¼ˆãƒ©ã‚¤ã‚¤ãƒ³ã‚°ï¼‰",alt:"",sets:1,repRange:"7ï½9",records:[]},{body:"è„š",name:"ã‚¢ãƒ€ã‚¯ã‚¿ãƒ¼ï¼ˆãƒã‚·ãƒ³ï¼‰",alt:"",sets:2,repRange:"9ï½11",records:[]},{body:"è‚©",name:"ã‚±ãƒ¼ãƒ–ãƒ«ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º",alt:"DBã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º",sets:2,repRange:"9ï½11",records:[]}],
  Upper:[{body:"è‚©",name:"ã‚¹ãƒŸã‚¹ãƒã‚·ãƒ³ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹",alt:"ãƒ€ãƒ³ãƒ™ãƒ«ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹",sets:2,repRange:"5ï½7",records:[]},{body:"èƒ¸",name:"ãƒã‚¤ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³DBãƒ—ãƒ¬ã‚¹",alt:"",sets:1,repRange:"5ï½7",records:[]},{body:"èƒŒä¸­",name:"ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ï¼ˆãƒ¯ã‚¤ãƒ‰ï¼‰",alt:"ãƒ¯ã‚¤ãƒ‰ãƒãƒ³ãƒ‹ãƒ³ã‚°",sets:2,repRange:"7ï½9",records:[]},{body:"èƒ¸",name:"ã‚±ãƒ¼ãƒ–ãƒ«ã‚¯ãƒ­ã‚¹ã‚ªãƒ¼ãƒãƒ¼",alt:"ãƒ€ãƒ³ãƒ™ãƒ«ãƒ•ãƒ©ã‚¤",sets:2,repRange:"9ï½11",records:[]},{body:"è‚©",name:"ã‚±ãƒ¼ãƒ–ãƒ«ãƒªã‚¢ãƒ¬ã‚¤ã‚º",alt:"ãƒªã‚¢ãƒ‡ãƒ«ãƒˆãƒ•ãƒ©ã‚¤ï¼ˆDBï¼‰",sets:2,repRange:"9ï½11",records:[]},{body:"è…•",name:"ã‚±ãƒ¼ãƒ–ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰EXT",alt:"ãƒ€ãƒ³ãƒ™ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰EXT",sets:2,repRange:"7ï½9",records:[]},{body:"è…•",name:"ã‚±ãƒ¼ãƒ–ãƒ«ã‚«ãƒ¼ãƒ«",alt:"ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«",sets:2,repRange:"8ï½10",records:[]}],
  Lower:[{body:"è„š",name:"ãƒ«ãƒ¼ãƒãƒ‹ã‚¢ãƒ³ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ",alt:"ãƒ€ãƒ³ãƒ™ãƒ«ãƒ«ãƒ¼ãƒãƒ‹ã‚¢ãƒ³ãƒ‡ãƒƒãƒ‰",sets:1,repRange:"5ï½7",records:[]},{body:"è„š",name:"ãƒ–ãƒ«ã‚¬ãƒªã‚¢ãƒ³ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ",alt:"",sets:2,repRange:"6ï½8",records:[]},{body:"è„š",name:"ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ«ï¼ˆãƒ©ã‚¤ã‚¤ãƒ³ã‚°ï¼‰",alt:"",sets:2,repRange:"7ï½9",records:[]},{body:"è„š",name:"ãƒ¬ãƒƒã‚°ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³",alt:"",sets:1,repRange:"7ï½9",records:[]},{body:"è„š",name:"ã‚¢ãƒ–ãƒ€ã‚¯ã‚¿ãƒ¼ï¼ˆãƒã‚·ãƒ³ï¼‰",alt:"",sets:2,repRange:"9ï½11",records:[]},{body:"è‚©",name:"ã‚±ãƒ¼ãƒ–ãƒ«ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º",alt:"DBã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º",sets:2,repRange:"9ï½11",records:[]},{body:"è„š",name:"ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ•ãƒ¬ã‚¤ã‚º",alt:"",sets:2,repRange:"15ï½20",records:[]}],
};
const MENU_TABS=["Push","Pull","Leg","Upper","Lower"];
const MENU_EMOJI={Push:"ğŸ«¸",Pull:"ğŸ«³",Leg:"ğŸ¦µ",Upper:"ğŸ’ª",Lower:"ğŸ‹ï¸","æ¸¬å®š":"ğŸ“"};
const WEEKDAYS=["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];
const todayStr=()=>{const d=new Date();return`${d.getMonth()+1}/${d.getDate()}`};
const DEFAULT_USERS=["WAKASA","TEZUKA"];
const USER_COLORS=["#E85555","#5588DD","#44BB66","#DDAA33","#9966DD","#DD6699","#55BBCC","#CC8844"];
const DC=o=>JSON.parse(JSON.stringify(o));

function getMonthDays(y,m){const st=new Date(y,m,1).getDay();const last=new Date(y,m+1,0).getDate();const c=[];for(let i=0;i<st;i++)c.push(null);for(let d=1;d<=last;d++)c.push(d);return c}
function buildTrainingMap(menus,y,m){const map={};const tm=m+1;for(const[mn,exs]of Object.entries(menus))for(const ex of exs){if(!ex.records)continue;for(const rec of ex.records){const p=rec.date.split("/").map(Number);if(p.length!==2||p[0]!==tm)continue;if(!rec.sets?.some(s=>(parseFloat(s.kg)||0)>0))continue;if(!map[rec.date])map[rec.date]={bodies:new Set(),menus:new Set()};map[rec.date].bodies.add(ex.body);map[rec.date].menus.add(mn)}}return map}
function getDateVol(menus,ds){let t=0;for(const exs of Object.values(menus))for(const ex of exs){const r=ex.records?.find(r=>r.date===ds);if(r)for(const s of r.sets)t+=(parseFloat(s.kg)||0)*(parseFloat(s.reps)||0)}return t}

/* â”€â”€ Sync Indicator â”€â”€ */
function SyncDot({syncing}){
  return <span style={{width:8,height:8,borderRadius:"50%",background:syncing?"#DDAA33":"#44BB66",display:"inline-block",marginLeft:6,animation:syncing?"pulse 1s infinite":"none"}} title={syncing?"åŒæœŸä¸­â€¦":"ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šä¸­"}/>;
}

/* â”€â”€ Exercise Picker â”€â”€ */
function ExercisePicker({open,onClose,onSelect,currentBody}){
  const[search,setSearch]=useState("");const[exp,setExp]=useState(currentBody||null);
  useEffect(()=>{if(open){setSearch("");setExp(currentBody||null)}},[open,currentBody]);
  if(!open)return null;
  const filtered=search.trim()?BODY_PARTS.reduce((a,bp)=>{const e=EXERCISES[bp].filter(x=>x.includes(search.trim()));if(e.length)a.push({bp,exs:e});return a},[]):null;
  return(<div style={{position:"fixed",inset:0,zIndex:1000,display:"flex",flexDirection:"column"}}>
    <div onClick={onClose} style={{position:"absolute",inset:0,background:"rgba(0,0,0,.5)",backdropFilter:"blur(4px)"}}/>
    <div style={{position:"relative",marginTop:"auto",maxHeight:"85vh",background:"#1a1a1a",borderRadius:"20px 20px 0 0",display:"flex",flexDirection:"column",overflow:"hidden"}}>
      <div style={{padding:"16px 20px 12px",borderBottom:"1px solid #333"}}>
        <div style={{width:40,height:4,background:"#555",borderRadius:2,margin:"0 auto 14px"}}/>
        <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="ç¨®ç›®ã‚’æ¤œç´¢â€¦" autoFocus style={{width:"100%",padding:"12px 16px",background:"#2a2a2a",border:"1px solid #444",borderRadius:12,color:"#fff",fontSize:16,outline:"none",boxSizing:"border-box"}}/></div>
      <div style={{overflow:"auto",flex:1,padding:"8px 0 env(safe-area-inset-bottom)"}}>
        {filtered?(filtered.length===0?<div style={{padding:32,textAlign:"center",color:"#888"}}>è©²å½“ãªã—</div>:filtered.map(({bp,exs})=>(<div key={bp}><div style={{padding:"10px 20px 6px",fontSize:12,fontWeight:700,color:BODY_COLORS[bp].accent,letterSpacing:1}}>{bp}</div>{exs.map(ex=><button key={ex} onClick={()=>{onSelect(bp,ex);onClose()}} style={{display:"block",width:"100%",padding:"14px 24px",background:"none",border:"none",color:"#ddd",fontSize:15,textAlign:"left",cursor:"pointer"}}>{ex}</button>)}</div>))):BODY_PARTS.map(bp=>(<div key={bp}>
          <button onClick={()=>setExp(exp===bp?null:bp)} style={{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"14px 20px",background:exp===bp?"#2a2a2a":"none",border:"none",borderBottom:"1px solid #2a2a2a",cursor:"pointer"}}><span style={{display:"flex",alignItems:"center",gap:10}}><span style={{width:10,height:10,borderRadius:"50%",background:BODY_COLORS[bp].accent}}/><span style={{color:"#eee",fontSize:16,fontWeight:600}}>{bp}</span><span style={{color:"#666",fontSize:13}}>{EXERCISES[bp].length}</span></span><span style={{color:"#666",fontSize:18,transform:exp===bp?"rotate(90deg)":"none",transition:"transform .2s"}}>â€º</span></button>
          {exp===bp&&<div style={{background:"#222"}}>{EXERCISES[bp].map(ex=><button key={ex} onClick={()=>{onSelect(bp,ex);onClose()}} style={{display:"block",width:"100%",padding:"13px 24px 13px 44px",background:"none",border:"none",borderBottom:"1px solid #2a2a2a",color:"#ccc",fontSize:15,textAlign:"left",cursor:"pointer"}}>{ex}</button>)}</div>}</div>))}</div></div></div>);
}

function ConfirmDialog({open,message,onConfirm,onCancel,confirmLabel="å‰Šé™¤",confirmColor="#D44"}){
  if(!open)return null;
  return(<div style={{position:"fixed",inset:0,zIndex:2000,display:"flex",alignItems:"center",justifyContent:"center"}}><div onClick={onCancel} style={{position:"absolute",inset:0,background:"rgba(0,0,0,.6)"}}/><div style={{position:"relative",background:"#222",borderRadius:16,padding:"24px 20px 16px",width:"min(320px,85vw)",textAlign:"center"}}><div style={{fontSize:15,color:"#ddd",marginBottom:20,lineHeight:1.6,whiteSpace:"pre-line"}}>{message}</div><div style={{display:"flex",gap:10}}><button onClick={onCancel} style={{flex:1,padding:"12px",background:"#333",border:"none",borderRadius:10,color:"#aaa",fontSize:15,fontWeight:600,cursor:"pointer"}}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button><button onClick={onConfirm} style={{flex:1,padding:"12px",background:confirmColor,border:"none",borderRadius:10,color:"#fff",fontSize:15,fontWeight:600,cursor:"pointer"}}>{confirmLabel}</button></div></div></div>);
}

function CalendarPicker({open,onClose,onSelect,currentDate}){
  const parsed=currentDate?.split("/").map(Number)||[];const now=new Date();
  const[vY,setVY]=useState(now.getFullYear());const[vM,setVM]=useState(parsed.length===2?parsed[0]-1:now.getMonth());
  useEffect(()=>{if(open){const p=currentDate?.split("/").map(Number);setVM(p?.length===2?p[0]-1:now.getMonth());setVY(now.getFullYear())}},[open]);
  if(!open)return null;
  const cells=getMonthDays(vY,vM);const todayDay=now.getFullYear()===vY&&now.getMonth()===vM?now.getDate():null;const selDay=parsed.length===2&&parsed[0]-1===vM?parsed[1]:null;
  const prev=()=>{if(vM===0){setVY(vY-1);setVM(11)}else setVM(vM-1)};const next=()=>{if(vM===11){setVY(vY+1);setVM(0)}else setVM(vM+1)};
  return(<div style={{position:"fixed",inset:0,zIndex:1000,display:"flex",flexDirection:"column"}}><div onClick={onClose} style={{position:"absolute",inset:0,background:"rgba(0,0,0,.5)",backdropFilter:"blur(4px)"}}/><div style={{position:"relative",marginTop:"auto",background:"#1a1a1a",borderRadius:"20px 20px 0 0",overflow:"hidden",padding:"16px 12px 20px"}}><div style={{width:40,height:4,background:"#555",borderRadius:2,margin:"0 auto 14px"}}/><div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12}}><button onClick={prev} style={{background:"#2a2a2a",border:"1px solid #333",borderRadius:8,color:"#aaa",fontSize:16,cursor:"pointer",padding:"4px 12px"}}>â€¹</button><span style={{fontSize:16,fontWeight:800,color:"#eee"}}>{vY}å¹´ {vM+1}æœˆ</span><button onClick={next} style={{background:"#2a2a2a",border:"1px solid #333",borderRadius:8,color:"#aaa",fontSize:16,cursor:"pointer",padding:"4px 12px"}}>â€º</button></div><div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)"}}>{WEEKDAYS.map((wd,i)=><div key={wd} style={{padding:"8px 0",textAlign:"center",fontSize:12,fontWeight:700,color:i===0?"#D46A6A":i===6?"#5B7DB8":"#666"}}>{wd}</div>)}</div><div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2}}>{cells.map((day,i)=>{if(day===null)return<div key={`e${i}`}/>;const isToday=day===todayDay;const isSel=day===selDay;const dow=i%7;return(<button key={i} onClick={()=>{onSelect(`${vM+1}/${day}`);onClose()}} style={{padding:"10px 0",background:isSel?"#FFD700":isToday?"#333":"none",border:"none",borderRadius:10,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}><span style={{fontSize:14,fontWeight:isSel||isToday?800:400,color:isSel?"#111":isToday?"#FFD700":dow===0?"#D46A6A":dow===6?"#5B7DB8":"#ccc"}}>{day}</span></button>)})}</div></div></div>);
}

function MenuPickerModal({open,onClose,onSelect,dateStr}){
  if(!open)return null;
  return(<div style={{position:"fixed",inset:0,zIndex:1000,display:"flex",flexDirection:"column"}}><div onClick={onClose} style={{position:"absolute",inset:0,background:"rgba(0,0,0,.5)",backdropFilter:"blur(4px)"}}/><div style={{position:"relative",marginTop:"auto",background:"#1a1a1a",borderRadius:"20px 20px 0 0",padding:"20px 16px 28px"}}><div style={{width:40,height:4,background:"#555",borderRadius:2,margin:"0 auto 16px"}}/><div style={{fontSize:16,fontWeight:800,color:"#eee",textAlign:"center",marginBottom:16}}>ğŸ“… {dateStr} ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</div><div style={{fontSize:13,color:"#888",textAlign:"center",marginBottom:16}}>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„</div><div style={{display:"flex",flexDirection:"column",gap:8}}>{MENU_TABS.map(t=>(<button key={t} onClick={()=>{onSelect(t);onClose()}} style={{display:"flex",alignItems:"center",gap:12,padding:"14px 18px",background:"#222",border:"1px solid #333",borderRadius:14,cursor:"pointer"}}><span style={{fontSize:24}}>{MENU_EMOJI[t]}</span><span style={{fontSize:16,fontWeight:700,color:"#ddd"}}>{t}</span></button>))}</div></div></div>);
}

function NumInput({value,onChange,unit,step=2.5,color="#aaa"}){const v=value||"";return(<div style={{display:"flex",alignItems:"center",gap:2}}><button onClick={()=>onChange(Math.max(0,(parseFloat(v)||0)-step))} style={{width:30,height:36,borderRadius:"8px 0 0 8px",border:"1px solid #333",background:"#2a2a2a",color:"#888",fontSize:18,cursor:"pointer",lineHeight:1}}>âˆ’</button><input value={v} onChange={e=>{const n=e.target.value;onChange(n===""?"":parseFloat(n)||0)}} inputMode="decimal" placeholder="â€”" style={{width:52,height:36,textAlign:"center",background:"#222",border:"1px solid #333",borderLeft:"none",borderRight:"none",color,fontSize:15,fontWeight:600,outline:"none"}}/><button onClick={()=>onChange((parseFloat(v)||0)+step)} style={{width:30,height:36,borderRadius:"0 8px 8px 0",border:"1px solid #333",background:"#2a2a2a",color:"#888",fontSize:18,cursor:"pointer",lineHeight:1}}>+</button><span style={{fontSize:11,color:"#666",marginLeft:2,minWidth:20}}>{unit}</span></div>)}

function UserBar({users,currentUser,onSwitch,onAdd,syncing}){
  const[adding,setAdding]=useState(false);const[newName,setNewName]=useState("");
  const handleAdd=()=>{const n=newName.trim().toUpperCase();if(n&&!users.includes(n)){onAdd(n);setNewName("");setAdding(false)}};
  return(<div style={{padding:"10px 12px 6px",background:"#111",borderBottom:"1px solid #222"}}><div style={{display:"flex",alignItems:"center",gap:6,overflowX:"auto",WebkitOverflowScrolling:"touch",scrollbarWidth:"none"}}>
    {users.map((u,i)=>{const active=u===currentUser;const color=USER_COLORS[i%USER_COLORS.length];return(<button key={u} onClick={()=>onSwitch(u)} style={{display:"flex",alignItems:"center",gap:6,padding:"7px 14px",background:active?`${color}20`:"#1a1a1a",border:active?`2px solid ${color}`:"1px solid #333",borderRadius:20,cursor:"pointer",flexShrink:0,transition:"all .15s"}}><span style={{width:22,height:22,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",background:active?color:"#333",color:active?"#fff":"#888",fontSize:11,fontWeight:800}}>{u[0]}</span><span style={{fontSize:13,fontWeight:active?800:500,color:active?"#eee":"#888"}}>{u}</span>{active&&<SyncDot syncing={syncing}/>}</button>)})}
    {!adding?<button onClick={()=>setAdding(true)} style={{width:34,height:34,borderRadius:"50%",background:"#1a1a1a",border:"1px dashed #555",color:"#666",fontSize:18,cursor:"pointer",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center"}}>ï¼‹</button>:<div style={{display:"flex",gap:4,flexShrink:0}}><input value={newName} onChange={e=>setNewName(e.target.value)} placeholder="åå‰" autoFocus onKeyDown={e=>e.key==="Enter"&&handleAdd()} style={{width:80,padding:"6px 10px",background:"#2a2a2a",border:"1px solid #555",borderRadius:8,color:"#fff",fontSize:13,outline:"none"}}/><button onClick={handleAdd} style={{padding:"6px 10px",background:"#444",border:"none",borderRadius:8,color:"#ddd",fontSize:12,fontWeight:700,cursor:"pointer"}}>è¿½åŠ </button><button onClick={()=>{setAdding(false);setNewName("")}} style={{padding:"6px 8px",background:"none",border:"none",color:"#888",fontSize:14,cursor:"pointer"}}>âœ•</button></div>}
  </div></div>);
}

/* â”€â”€ Session Detail â”€â”€ */
function SessionDetail({dateStr,menus,comments,onBack,onGoToMenu}){
  const dayData=[];for(const[mn,exs]of Object.entries(menus))for(const ex of exs){const rec=ex.records?.find(r=>r.date===dateStr);if(!rec||!rec.sets?.some(s=>(parseFloat(s.kg)||0)>0))continue;dayData.push({mn,ex,rec})}
  const totalVol=dayData.reduce((t,{rec})=>t+rec.sets.reduce((s,set)=>s+(parseFloat(set.kg)||0)*(parseFloat(set.reps)||0),0),0);
  const menuNames=[...new Set(dayData.map(d=>d.mn))];const bodies=[...new Set(dayData.map(d=>d.ex.body))];
  const grouped={};for(const d of dayData){if(!grouped[d.mn])grouped[d.mn]=[];grouped[d.mn].push(d)}
  const bestSet=(rec)=>{let best=null,bv=0;for(const s of rec.sets){const v=(parseFloat(s.kg)||0)*(parseFloat(s.reps)||0);if(v>bv){bv=v;best=s}}return best};
  return(<div style={{padding:"0 0 16px",minHeight:"calc(100vh - 140px)"}}>
    <div style={{padding:"12px 16px",display:"flex",alignItems:"center",gap:12,borderBottom:"1px solid #222"}}><button onClick={onBack} style={{background:"#2a2a2a",border:"1px solid #333",borderRadius:10,padding:"6px 12px",color:"#aaa",fontSize:16,cursor:"pointer"}}>â€¹ æˆ»ã‚‹</button><div style={{fontSize:20,fontWeight:900,color:"#fff"}}>ğŸ“… {dateStr}</div></div>
    <div style={{padding:"12px 14px"}}>
      <div style={{display:"flex",gap:8,marginBottom:14}}><div style={{flex:1,background:"#1a1a1a",borderRadius:14,padding:"14px",border:"1px solid #2a2a2a"}}><div style={{fontSize:11,color:"#888",marginBottom:4}}>ç·ãƒœãƒªãƒ¥ãƒ¼ãƒ </div><div style={{fontSize:26,fontWeight:900,color:totalVol>0?"#FFD700":"#444"}}>{totalVol>0?totalVol.toLocaleString():"â€”"}</div></div><div style={{flex:1,background:"#1a1a1a",borderRadius:14,padding:"14px",border:"1px solid #2a2a2a"}}><div style={{fontSize:11,color:"#888",marginBottom:4}}>ç¨®ç›®æ•°</div><div style={{fontSize:26,fontWeight:900,color:"#fff"}}>{dayData.length}<span style={{fontSize:13,color:"#666"}}> ç¨®ç›®</span></div></div></div>
      {bodies.length>0&&<div style={{display:"flex",gap:6,marginBottom:16,flexWrap:"wrap"}}>{bodies.map(bp=>{const c=BODY_COLORS[bp];return(<span key={bp} style={{display:"inline-flex",alignItems:"center",gap:5,padding:"5px 12px",borderRadius:10,background:`${c.accent}15`,border:`1px solid ${c.accent}30`}}><span style={{width:9,height:9,borderRadius:"50%",background:c.dot}}/><span style={{fontSize:13,fontWeight:700,color:c.accent}}>{bp}</span></span>)})}</div>}
      {menuNames.length>0&&<div style={{display:"flex",gap:8,marginBottom:16}}>{menuNames.map(mn=><button key={mn} onClick={()=>onGoToMenu(mn,dateStr)} style={{flex:1,padding:"10px",background:"#2a2a2a",border:"1px solid #444",borderRadius:12,color:"#ddd",fontSize:14,fontWeight:600,cursor:"pointer"}}>{MENU_EMOJI[mn]} {mn}ã‚’ç·¨é›†</button>)}</div>}
      {dayData.length===0?<div style={{padding:40,textAlign:"center",color:"#666",fontSize:15}}>ã“ã®æ—¥ã®è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“</div>:Object.entries(grouped).map(([mn,items])=>(<div key={mn} style={{marginBottom:16}}>
        <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:10}}><span style={{fontSize:18}}>{MENU_EMOJI[mn]}</span><span style={{fontSize:15,fontWeight:800,color:"#ccc"}}>{mn}</span><span style={{fontSize:12,color:"#666"}}>{items.length}ç¨®ç›®</span></div>
        {items.map(({ex,rec},i)=>{const c=BODY_COLORS[ex.body];const exVol=rec.sets.reduce((s,set)=>s+(parseFloat(set.kg)||0)*(parseFloat(set.reps)||0),0);const best=bestSet(rec);return(<div key={i} style={{background:"#1a1a1a",borderRadius:14,marginBottom:8,overflow:"hidden",border:`1px solid ${c.border}30`}}><div style={{padding:"12px 14px 10px",background:`linear-gradient(135deg,${c.bg}18,${c.bg}08)`,borderBottom:`1px solid ${c.border}20`}}><div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}><div style={{display:"flex",alignItems:"center",gap:8}}><span style={{padding:"2px 8px",borderRadius:6,background:`${c.accent}25`,color:c.accent,fontSize:11,fontWeight:700}}>{ex.body}</span><span style={{fontSize:15,fontWeight:700,color:"#eee"}}>{ex.name}</span></div><span style={{fontSize:14,fontWeight:800,color:"#FFD700"}}>{exVol>0?exVol.toLocaleString():""}</span></div>{best&&<div style={{marginTop:6,fontSize:12,color:"#888"}}>ğŸ† ãƒ™ã‚¹ãƒˆ: <span style={{color:"#ddd",fontWeight:700}}>{best.kg}kg Ã— {best.reps}</span></div>}</div><div style={{padding:"8px 14px 12px"}}>{rec.sets.map((s,si)=>{const sv=(parseFloat(s.kg)||0)*(parseFloat(s.reps)||0);const isBest=best&&s.kg===best.kg&&s.reps===best.reps;return(<div key={si} style={{display:"flex",alignItems:"center",gap:10,padding:"7px 0",borderBottom:si<rec.sets.length-1?"1px solid #2a2a2a":"none"}}><span style={{width:24,height:24,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",background:isBest?`${c.accent}30`:"#222",color:isBest?c.accent:"#888",fontSize:11,fontWeight:700}}>{si+1}</span><span style={{fontSize:15,fontWeight:600,color:"#ddd",minWidth:60}}>{s.kg||"â€”"}<span style={{fontSize:11,color:"#888"}}> kg</span></span><span style={{color:"#444",fontSize:14}}>Ã—</span><span style={{fontSize:15,fontWeight:600,color:"#ddd",minWidth:30}}>{s.reps||"â€”"}<span style={{fontSize:11,color:"#888"}}> rep</span></span><span style={{marginLeft:"auto",fontSize:13,fontWeight:700,color:sv>0?"#FFD700":"#333"}}>{sv>0?sv.toLocaleString():"â€”"}</span></div>)})}</div></div>)})}
        {(()=>{const key=`${dateStr}_${mn}`;const cmts=comments[key];if(!cmts?.length)return null;return(<div style={{background:"#1a2a1a",borderRadius:12,padding:"12px 14px",marginBottom:8,border:"1px solid #2a4a2a"}}><div style={{fontSize:12,fontWeight:700,color:"#4FA06A",marginBottom:8}}>ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆ</div>{cmts.map((c,ci)=>(<div key={ci} style={{marginBottom:ci<cmts.length-1?8:0}}><div style={{fontSize:12,fontWeight:700,color:"#8BC88B"}}>{c.author||"åŒ¿å"}</div><div style={{fontSize:14,color:"#ccc",lineHeight:1.5,marginTop:2}}>{c.text}</div></div>))}</div>)})()}
      </div>))}
    </div>
  </div>);
}

/* â”€â”€ Home Screen â”€â”€ */
function HomeScreen({menus,onGoToMenu,onSelectDay,onNewSession,currentUser}){
  const now=new Date();const[vY,setVY]=useState(now.getFullYear());const[vM,setVM]=useState(now.getMonth());
  const cells=useMemo(()=>getMonthDays(vY,vM),[vY,vM]);
  const tMap=useMemo(()=>buildTrainingMap(menus,vY,vM),[menus,vY,vM]);
  const todayDay=now.getFullYear()===vY&&now.getMonth()===vM?now.getDate():null;
  const prev=()=>{if(vM===0){setVY(vY-1);setVM(11)}else setVM(vM-1)};const next=()=>{if(vM===11){setVY(vY+1);setVM(0)}else setVM(vM+1)};
  const dates=Object.keys(tMap);const trainDays=dates.length;
  const monthVol=dates.reduce((t,d)=>t+getDateVol(menus,d),0);
  const bodyFreq={};for(const d of dates)for(const b of tMap[d].bodies)bodyFreq[b]=(bodyFreq[b]||0)+1;
  const allDates=[];for(const exs of Object.values(menus))for(const ex of exs){if(!ex.records)continue;for(const rec of ex.records)if(rec.sets?.some(s=>(parseFloat(s.kg)||0)>0)&&!allDates.includes(rec.date))allDates.push(rec.date)}
  allDates.sort((a,b)=>{const[am,ad]=a.split("/").map(Number);const[bm,bd]=b.split("/").map(Number);return bm-am||bd-ad});
  const recent=allDates.slice(-5).reverse();
  return(<div style={{padding:"0 12px 16px"}}>
    <div style={{padding:"12px 4px 8px",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
      <div style={{fontSize:22,fontWeight:900}}>ğŸ‹ï¸ ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆ</div>
      <a href={`/api/export/${currentUser}`} download style={{padding:"6px 12px",background:"#2a2a2a",border:"1px solid #444",borderRadius:8,color:"#aaa",fontSize:11,fontWeight:700,textDecoration:"none",display:"flex",alignItems:"center",gap:4}}>ğŸ“¤ CSVå‡ºåŠ›</a>
    </div>
    <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 0 12px"}}><button onClick={prev} style={{background:"#2a2a2a",border:"1px solid #333",borderRadius:10,color:"#aaa",fontSize:18,cursor:"pointer",padding:"6px 14px"}}>â€¹</button><span style={{fontSize:17,fontWeight:800,color:"#eee"}}>{vY}å¹´ {vM+1}æœˆ</span><button onClick={next} style={{background:"#2a2a2a",border:"1px solid #333",borderRadius:10,color:"#aaa",fontSize:18,cursor:"pointer",padding:"6px 14px"}}>â€º</button></div>
    <div style={{display:"flex",gap:8,marginBottom:12}}><div style={{flex:1,background:"#1a1a1a",borderRadius:14,padding:"12px 14px",border:"1px solid #2a2a2a"}}><div style={{fontSize:11,color:"#888",marginBottom:4}}>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°</div><div style={{fontSize:24,fontWeight:900,color:trainDays>0?"#fff":"#444"}}>{trainDays}<span style={{fontSize:13,color:"#666",fontWeight:400}}> æ—¥</span></div></div><div style={{flex:1,background:"#1a1a1a",borderRadius:14,padding:"12px 14px",border:"1px solid #2a2a2a"}}><div style={{fontSize:11,color:"#888",marginBottom:4}}>æœˆé–“ãƒœãƒªãƒ¥ãƒ¼ãƒ </div><div style={{fontSize:24,fontWeight:900,color:monthVol>0?"#FFD700":"#444"}}>{monthVol>0?monthVol.toLocaleString():"â€”"}</div></div></div>
    {trainDays>0&&<div style={{display:"flex",gap:6,marginBottom:14,flexWrap:"wrap"}}>{BODY_PARTS.filter(bp=>bodyFreq[bp]).map(bp=>(<span key={bp} style={{display:"inline-flex",alignItems:"center",gap:4,padding:"4px 10px",borderRadius:8,background:`${BODY_COLORS[bp].accent}18`,border:`1px solid ${BODY_COLORS[bp].accent}30`}}><span style={{width:8,height:8,borderRadius:"50%",background:BODY_COLORS[bp].dot}}/><span style={{fontSize:12,fontWeight:600,color:BODY_COLORS[bp].accent}}>{bp}</span><span style={{fontSize:12,fontWeight:800,color:BODY_COLORS[bp].text}}>Ã—{bodyFreq[bp]}</span></span>))}</div>}
    <div style={{background:"#1a1a1a",borderRadius:16,overflow:"hidden",border:"1px solid #2a2a2a"}}><div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)"}}>{WEEKDAYS.map((wd,i)=><div key={wd} style={{padding:"10px 0",textAlign:"center",fontSize:12,fontWeight:700,color:i===0?"#D46A6A":i===6?"#5B7DB8":"#666",background:"#222"}}>{wd}</div>)}</div><div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)"}}>{cells.map((day,i)=>{if(day===null)return<div key={`e${i}`} style={{padding:6}}/>;const ds=`${vM+1}/${day}`;const info=tMap[ds];const isToday=day===todayDay;const dow=i%7;return(<button key={i} onClick={()=>{info?onSelectDay(ds):onNewSession(ds)}} style={{padding:"6px 2px 8px",background:info?"#ffffff08":"none",border:"none",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:3,borderTop:"1px solid #2a2a2a",transition:"background .15s"}}><span style={{width:28,height:28,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",background:isToday?"#FFD700":"transparent",color:isToday?"#111":dow===0?"#D46A6A":dow===6?"#5B7DB8":"#ccc",fontSize:13,fontWeight:isToday?800:info?700:400}}>{day}</span><div style={{display:"flex",gap:3,minHeight:8,justifyContent:"center",flexWrap:"wrap"}}>{info?[...info.bodies].map(bp=><span key={bp} style={{width:7,height:7,borderRadius:"50%",background:BODY_COLORS[bp]?.dot||"#888"}}/>):<span style={{width:7,height:7}}/>}</div></button>)})}</div></div>
    <div style={{display:"flex",gap:10,justifyContent:"center",marginTop:12,flexWrap:"wrap"}}>{BODY_PARTS.map(bp=><span key={bp} style={{display:"inline-flex",alignItems:"center",gap:4,fontSize:11,color:"#888"}}><span style={{width:7,height:7,borderRadius:"50%",background:BODY_COLORS[bp].dot}}/>{bp}</span>)}</div>
    {recent.length>0&&<div style={{marginTop:20}}><div style={{fontSize:14,fontWeight:800,color:"#ccc",marginBottom:10,paddingLeft:4}}>ğŸ“ æœ€è¿‘ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³</div>{recent.map(ds=>{const bodies=new Set();const ms=new Set();let vol=0;for(const[mn,exs]of Object.entries(menus))for(const ex of exs){const r=ex.records?.find(r=>r.date===ds);if(!r||!r.sets?.some(s=>(parseFloat(s.kg)||0)>0))continue;bodies.add(ex.body);ms.add(mn);for(const s of r.sets)vol+=(parseFloat(s.kg)||0)*(parseFloat(s.reps)||0)}return(<button key={ds} onClick={()=>onSelectDay(ds)} style={{display:"flex",alignItems:"center",width:"100%",padding:"12px 14px",background:"#1a1a1a",border:"1px solid #2a2a2a",borderRadius:12,marginBottom:8,cursor:"pointer",gap:12}}><div style={{fontSize:16,fontWeight:800,color:"#ddd",minWidth:48}}>{ds}</div><div style={{display:"flex",gap:4,flex:1,flexWrap:"wrap"}}>{[...bodies].map(bp=><span key={bp} style={{width:10,height:10,borderRadius:"50%",background:BODY_COLORS[bp]?.dot}}/>)}{[...ms].map(mn=><span key={mn} style={{fontSize:11,color:"#888",background:"#2a2a2a",padding:"1px 6px",borderRadius:4}}>{mn}</span>)}</div><div style={{fontSize:14,fontWeight:800,color:"#FFD700",whiteSpace:"nowrap"}}>{vol>0?vol.toLocaleString():""}</div></button>)})}</div>}
  </div>);
}

/* â”€â”€ Menu Screen â”€â”€ */
function MenuScreen({menus,tab,sessionDate,setSessionDate,onSave,comments,onSaveComment,onDirtyChange}){
  const[draft,setDraft]=useState(()=>DC(menus[tab]||[]));const[dirty,setDirty]=useState(false);const[picker,setPicker]=useState(null);const[showHist,setShowHist]=useState(null);const[confirm,setConfirm]=useState(null);const[calOpen,setCalOpen]=useState(false);const[saved,setSaved]=useState(false);
  const commentKey=`${sessionDate}_${tab}`;const existingComments=comments[commentKey]||[];const[cmtAuthor,setCmtAuthor]=useState("");const[cmtText,setCmtText]=useState("");
  // Only reset draft when tab or sessionDate changes, NOT when menus changes from polling
  const prevTabRef=useRef(tab);const prevDateRef=useRef(sessionDate);
  useEffect(()=>{if(prevTabRef.current!==tab||prevDateRef.current!==sessionDate){setDraft(DC(menus[tab]||[]));setDirty(false);setSaved(false);prevTabRef.current=tab;prevDateRef.current=sessionDate}},[tab,sessionDate,menus]);
  // Notify parent of dirty state so polling doesn't overwrite
  useEffect(()=>{if(onDirtyChange)onDirtyChange(dirty)},[dirty,onDirtyChange]);
  const exercises=draft;
  const updateDraft=(fn)=>{setDraft(prev=>{const next=DC(prev);fn(next);return next});setDirty(true);setSaved(false)};
  const updateEx=(i,f,v)=>updateDraft(d=>{d[i][f]=v});
  const addExercise=(bp,name)=>updateDraft(d=>{d.push({body:bp,name,alt:"",sets:2,repRange:"8ï½10",records:[]})});
  const removeExercise=(ei)=>{updateDraft(d=>{d.splice(ei,1)});setConfirm(null)};
  const addSet=(ei)=>updateDraft(d=>{d[ei].sets+=1;(d[ei].records||[]).forEach(r=>r.sets.push({kg:"",reps:""}))});
  const removeSet=(ei)=>{updateDraft(d=>{if(d[ei].sets<=1)return;d[ei].sets-=1;(d[ei].records||[]).forEach(r=>{r.sets=r.sets.slice(0,d[ei].sets)})});setConfirm(null)};
  const updateSet=(ei,si,f,v)=>updateDraft(d=>{const ex=d[ei];let recs=ex.records||[];let dr=recs.find(r=>r.date===sessionDate);if(!dr){dr={date:sessionDate,sets:Array.from({length:ex.sets},()=>({kg:"",reps:""}))};recs.push(dr);ex.records=recs}while(dr.sets.length<ex.sets)dr.sets.push({kg:"",reps:""});dr.sets[si][f]=v});
  const getSD=(ex,si)=>ex.records?.find(r=>r.date===sessionDate)?.sets?.[si]||{kg:"",reps:""};
  const getPrev=(ex)=>{if(!ex.records?.length)return null;const s=ex.records.filter(r=>r.date!==sessionDate).sort((a,b)=>{const[am,ad]=a.date.split("/").map(Number);const[bm,bd]=b.date.split("/").map(Number);return bm-am||bd-ad});return s.length?s[s.length-1]:null};
  const totalVol=exercises.reduce((t,ex)=>{const r=ex.records?.find(r=>r.date===sessionDate);if(!r)return t;return t+r.sets.reduce((s,set)=>s+(parseFloat(set.kg)||0)*(parseFloat(set.reps)||0),0)},0);
  const handleSave=()=>{onSave(tab,draft);setSaved(true);setDirty(false)};
  const handleAddComment=()=>{if(!cmtText.trim())return;onSaveComment(commentKey,cmtAuthor.trim()||"åŒ¿å",cmtText.trim());setCmtText("")};
  return(<>
    <div style={{position:"sticky",top:0,zIndex:100,background:"#111",borderBottom:"1px solid #222"}}><div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 16px 8px"}}><div style={{fontSize:20,fontWeight:900}}>{MENU_EMOJI[tab]} {tab}</div><button onClick={()=>setCalOpen(true)} style={{padding:"6px 12px",background:"#2a2a2a",border:"1px solid #444",borderRadius:8,color:"#fff",fontSize:14,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:6}}>ğŸ“… {sessionDate}</button></div><div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px 10px"}}><span style={{fontSize:12,color:"#888"}}>ã‚»ãƒƒã‚·ãƒ§ãƒ³ç·Vol</span><span style={{fontSize:18,fontWeight:900,color:totalVol>0?"#FFD700":"#444"}}>{totalVol>0?totalVol.toLocaleString():"â€”"}</span></div></div>
    <div style={{padding:"8px 10px"}}>
      {exercises.map((ex,ei)=>{const c=BODY_COLORS[ex.body]||BODY_COLORS["èƒ¸"];const prev=getPrev(ex);return(<div key={ei} style={{background:"#1a1a1a",borderRadius:16,marginBottom:10,overflow:"hidden",border:`1px solid ${c.border}30`}}>
        <div style={{background:`linear-gradient(135deg,${c.bg}18,${c.bg}08)`,padding:"12px 14px 10px",borderBottom:`1px solid ${c.border}25`}}><div style={{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:8}}><div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:6,marginBottom:4}}><span style={{padding:"2px 8px",borderRadius:6,background:`${c.accent}25`,color:c.accent,fontSize:11,fontWeight:700}}>{ex.body}</span><span style={{fontSize:11,color:"#666"}}>{ex.sets}ã‚»ãƒƒãƒˆãƒ»{ex.repRange}Rep</span></div><button onClick={()=>setPicker({ei,field:"name"})} style={{background:"none",border:"none",color:"#eee",fontSize:15,fontWeight:700,cursor:"pointer",padding:0,textAlign:"left"}}>{ex.name} <span style={{color:"#555",fontSize:12}}>â–¼</span></button>{ex.alt?<button onClick={()=>setPicker({ei,field:"alt"})} style={{display:"flex",alignItems:"center",gap:4,marginTop:4,background:"none",border:"none",cursor:"pointer",padding:0}}><span style={{fontSize:10,color:"#888",background:"#2a2a2a",padding:"1px 6px",borderRadius:4}}>ğŸ è‡ªå®…</span><span style={{fontSize:12,color:"#999"}}>{ex.alt} â–¼</span></button>:<button onClick={()=>setPicker({ei,field:"alt"})} style={{background:"none",border:"none",cursor:"pointer",padding:"4px 0 0",color:"#555",fontSize:11}}>ï¼‹ è‡ªå®…ä»£æ›¿ã‚’è¿½åŠ </button>}</div><div style={{display:"flex",flexDirection:"column",gap:4,alignItems:"flex-end"}}>{prev&&<button onClick={()=>setShowHist(showHist===ei?null:ei)} style={{background:"#2a2a2a",border:"1px solid #333",borderRadius:8,padding:"4px 8px",cursor:"pointer",color:"#888",fontSize:10,whiteSpace:"nowrap"}}>å‰å› ğŸ“Š</button>}<button onClick={()=>setConfirm({type:"exercise",ei})} style={{background:"none",border:"none",cursor:"pointer",padding:"2px 4px",color:"#664444",fontSize:12}}>ğŸ—‘</button></div></div>{showHist===ei&&prev&&<div style={{marginTop:8,padding:"8px 10px",background:"#22222280",borderRadius:8,fontSize:12,color:"#888"}}><span style={{fontWeight:600}}>{prev.date}</span>{prev.sets.map((s,i)=><span key={i} style={{marginLeft:10}}>S{i+1}: {s.kg||"â€”"}kgÃ—{s.reps||"â€”"}</span>)}</div>}</div>
        <div style={{padding:"10px 14px 10px"}}>{Array.from({length:ex.sets},(_,si)=>{const sd=getSD(ex,si);const vol=(parseFloat(sd.kg)||0)*(parseFloat(sd.reps)||0);return(<div key={si} style={{display:"flex",alignItems:"center",gap:8,marginBottom:8,padding:"6px 0"}}><span style={{width:26,height:26,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",background:`${c.accent}20`,color:c.accent,fontSize:12,fontWeight:700,flexShrink:0}}>{si+1}</span><NumInput value={sd.kg} onChange={v=>updateSet(ei,si,"kg",v)} unit="kg" step={2.5} color="#eee"/><span style={{color:"#444",fontSize:16}}>Ã—</span><NumInput value={sd.reps} onChange={v=>updateSet(ei,si,"reps",v)} unit="rep" step={1} color="#eee"/><div style={{marginLeft:"auto",fontSize:13,fontWeight:700,color:vol>0?"#FFD700":"#333",minWidth:48,textAlign:"right"}}>{vol>0?vol.toLocaleString():"â€”"}</div></div>)})}
          <div style={{display:"flex",justifyContent:"center",gap:12,marginTop:4,paddingTop:6,borderTop:"1px solid #2a2a2a"}}><button onClick={()=>addSet(ei)} style={{padding:"6px 14px",background:"#222",border:"1px solid #333",borderRadius:8,color:"#888",fontSize:12,fontWeight:600,cursor:"pointer"}}>ï¼‹ ã‚»ãƒƒãƒˆè¿½åŠ </button>{ex.sets>1&&<button onClick={()=>setConfirm({type:"set",ei})} style={{padding:"6px 14px",background:"#222",border:"1px solid #333",borderRadius:8,color:"#774444",fontSize:12,fontWeight:600,cursor:"pointer"}}>âˆ’ ã‚»ãƒƒãƒˆå‰Šé™¤</button>}</div></div></div>)})}
      <button onClick={()=>setPicker({mode:"add"})} style={{display:"flex",alignItems:"center",justifyContent:"center",gap:8,width:"100%",padding:"16px",marginTop:4,marginBottom:8,background:"#1a1a1a",border:"2px dashed #333",borderRadius:16,color:"#888",fontSize:15,fontWeight:700,cursor:"pointer"}}>ï¼‹ ç¨®ç›®ã‚’è¿½åŠ </button>
      {/* Comment Section */}
      <div style={{background:"#1a1a1a",borderRadius:16,padding:"16px 14px",marginBottom:8,border:"1px solid #2a4a2a"}}>
        <div style={{fontSize:14,fontWeight:800,color:"#4FA06A",marginBottom:12}}>ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ{sessionDate} / {tab}ï¼‰</div>
        {existingComments.length>0&&<div style={{marginBottom:12}}>{existingComments.map((c,i)=>(<div key={i} style={{padding:"10px 12px",background:"#222",borderRadius:10,marginBottom:6,border:"1px solid #333"}}><div style={{display:"flex",alignItems:"center",gap:6,marginBottom:4}}><span style={{width:20,height:20,borderRadius:"50%",background:"#4FA06A",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:9,fontWeight:800}}>{(c.author||"åŒ¿")[0]}</span><span style={{fontSize:13,fontWeight:700,color:"#8BC88B"}}>{c.author||"åŒ¿å"}</span>{c.time&&<span style={{fontSize:10,color:"#666"}}>{new Date(c.time).toLocaleString("ja-JP",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}</span>}</div><div style={{fontSize:14,color:"#ccc",lineHeight:1.5}}>{c.text}</div></div>))}</div>}
        <div style={{display:"flex",gap:6,marginBottom:8}}><input value={cmtAuthor} onChange={e=>setCmtAuthor(e.target.value)} placeholder="åå‰ï¼ˆä¾‹ï¼šãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼å±±ç”°ï¼‰" style={{flex:1,padding:"8px 12px",background:"#222",border:"1px solid #444",borderRadius:8,color:"#fff",fontSize:13,outline:"none"}}/></div>
        <div style={{display:"flex",gap:6}}><textarea value={cmtText} onChange={e=>setCmtText(e.target.value)} placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›â€¦" rows={2} style={{flex:1,padding:"8px 12px",background:"#222",border:"1px solid #444",borderRadius:8,color:"#fff",fontSize:13,outline:"none",lineHeight:1.5}}/><button onClick={handleAddComment} style={{padding:"8px 14px",background:cmtText.trim()?"#4FA06A":"#333",border:"none",borderRadius:8,color:cmtText.trim()?"#fff":"#666",fontSize:13,fontWeight:700,cursor:cmtText.trim()?"pointer":"default",alignSelf:"flex-end"}}>é€ä¿¡</button></div>
      </div>
      <div style={{height:70}}/>
    </div>
    <div style={{position:"fixed",bottom:62,left:0,right:0,zIndex:99,padding:"0 14px",paddingBottom:"env(safe-area-inset-bottom)"}}><button onClick={handleSave} disabled={!dirty&&!saved} style={{width:"100%",padding:"14px",borderRadius:14,border:"none",fontSize:16,fontWeight:800,cursor:dirty?"pointer":"default",background:saved?"#2E6E3E":dirty?"#FFD700":"#333",color:saved?"#fff":dirty?"#111":"#666",transition:"all .2s",boxShadow:dirty?"0 4px 20px rgba(255,215,0,.3)":"none"}}>{saved?"âœ“ ä¿å­˜ã—ã¾ã—ãŸ":dirty?"ğŸ’¾ è¨˜éŒ²ã‚’ä¿å­˜":"å¤‰æ›´ãªã—"}</button></div>
    <ExercisePicker open={picker!==null} onClose={()=>setPicker(null)} currentBody={picker&&picker.ei!=null?exercises[picker.ei]?.body:null} onSelect={(bp,exName)=>{if(picker.mode==="add")addExercise(bp,exName);else if(picker.field==="name"){updateEx(picker.ei,"name",exName);updateEx(picker.ei,"body",bp)}else updateEx(picker.ei,"alt",exName)}}/>
    <ConfirmDialog open={confirm!==null} message={confirm?.type==="exercise"?`ã€Œ${exercises[confirm?.ei]?.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nè¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ã‚‚æ¶ˆå»ã•ã‚Œã¾ã™ã€‚`:`æœ€å¾Œã®ã‚»ãƒƒãƒˆï¼ˆS${exercises[confirm?.ei]?.sets}ï¼‰ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`} onConfirm={()=>{if(confirm.type==="exercise")removeExercise(confirm.ei);else removeSet(confirm.ei)}} onCancel={()=>setConfirm(null)}/>
    <CalendarPicker open={calOpen} onClose={()=>setCalOpen(false)} currentDate={sessionDate} onSelect={ds=>setSessionDate(ds)}/>
  </>);
}

/* â”€â”€ App â”€â”€ */
/* â”€â”€ Measurement Screen â”€â”€ */
const MFIELDS=[
  {key:"weight",label:"ä½“é‡",unit:"kg",color:"#E85555",icon:"âš–ï¸"},
  {key:"waist",label:"è…¹å›²",unit:"cm",color:"#DDAA33",icon:"ğŸ“"},
  {key:"chest",label:"èƒ¸å›²",unit:"cm",color:"#D46A6A",icon:"ğŸ“"},
  {key:"arm",label:"ä¸Šè…•",unit:"cm",color:"#5B7DB8",icon:"ğŸ’ª"},
  {key:"thigh",label:"å¤§è…¿",unit:"cm",color:"#8A60C0",icon:"ğŸ¦µ"},
  {key:"hip",label:"ãƒ’ãƒƒãƒ—",unit:"cm",color:"#4FA06A",icon:"ğŸ“"},
];
function MeasurementScreen({measurements,onSave,onDelete,onDirtyChange}){
  const today=new Date();const todayISO=`${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,"0")}-${String(today.getDate()).padStart(2,"0")}`;
  const[date,setDate]=useState(todayISO);
  const[form,setForm]=useState({weight:"",waist:"",chest:"",arm:"",thigh:"",hip:"",memo:""});
  const[saving,setSaving]=useState(false);
  const[showHistory,setShowHistory]=useState(true);
  const[confirm,setConfirm]=useState(null);
  const[formDirty,setFormDirty]=useState(false);
  useEffect(()=>{if(onDirtyChange)onDirtyChange(formDirty)},[formDirty,onDirtyChange]);

  // Only reset form when date changes (not when measurements updates from polling)
  const prevDateRef=useRef(date);
  useEffect(()=>{
    if(prevDateRef.current!==date||!formDirty){
      const existing=measurements.find(m=>m.date===date);
      if(existing){setForm({weight:existing.weight||"",waist:existing.waist||"",chest:existing.chest||"",arm:existing.arm||"",thigh:existing.thigh||"",hip:existing.hip||"",memo:existing.memo||""})}
      else{setForm({weight:"",waist:"",chest:"",arm:"",thigh:"",hip:"",memo:""})}
      setFormDirty(false);
      prevDateRef.current=date;
    }
  },[date]);

  // When date changes via history row click, load that date's data
  const selectDate=(d)=>{setFormDirty(false);prevDateRef.current="";setDate(d)};

  const updateField=(key,val)=>{setForm(p=>({...p,[key]:val}));setFormDirty(true)};

  const handleSave=async()=>{
    setSaving(true);
    try{await onSave({date,...form})}catch(e){console.error("Save error:",e)}
    setFormDirty(false);
    setSaving(false);
  };
  const handleDelete=async(d)=>{
    await onDelete(d);
    setConfirm(null);
    // If deleted the currently selected date, clear form
    if(d===date){setForm({weight:"",waist:"",chest:"",arm:"",thigh:"",hip:"",memo:""});setFormDirty(false)}
  };
  const hasInput=Object.values(form).some(v=>v!=="");

  // Get previous measurement for comparison
  const getPrev=(key)=>{
    const sorted=[...measurements].sort((a,b)=>a.date>b.date?-1:1);
    const curr=sorted.findIndex(m=>m.date===date);
    const prev=sorted.find((m,i)=>i>(curr===-1?-1:curr)&&m[key]);
    return prev?prev[key]:null;
  };
  const getDiff=(key)=>{
    const cur=parseFloat(form[key]);const prev=parseFloat(getPrev(key));
    if(isNaN(cur)||isNaN(prev))return null;
    const d=cur-prev;
    return d;
  };

  return(
    <div style={{padding:"0 0 16px",minHeight:"calc(100vh - 140px)",overflowX:"hidden"}}>
      <div style={{position:"sticky",top:0,zIndex:100,background:"#111",borderBottom:"1px solid #222",padding:"12px 16px"}}>
        <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10}}>
          <div style={{fontSize:20,fontWeight:900}}>ğŸ“ èº«ä½“æ¸¬å®šãƒ­ã‚°</div>
        </div>
        <input type="date" value={date} onChange={e=>selectDate(e.target.value)}
          style={{display:"block",width:"100%",maxWidth:"100%",padding:"10px 14px",background:"#2a2a2a",border:"1px solid #444",borderRadius:10,color:"#fff",fontSize:16,outline:"none",colorScheme:"dark",boxSizing:"border-box",WebkitAppearance:"none"}}/>
      </div>

      <div style={{padding:"12px 12px 8px"}}>
        {/* Input fields */}
        <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:8,marginBottom:12}}>
          {MFIELDS.map(f=>{
            const diff=getDiff(f.key);
            return(
              <div key={f.key} style={{background:"#1a1a1a",borderRadius:12,padding:"10px",border:`1px solid ${f.color}30`}}>
                <div style={{display:"flex",alignItems:"center",gap:4,marginBottom:6}}>
                  <span style={{fontSize:13}}>{f.icon}</span>
                  <span style={{fontSize:11,fontWeight:700,color:f.color}}>{f.label}</span>
                  {diff!==null&&<span style={{marginLeft:"auto",fontSize:10,fontWeight:700,color:f.key==="weight"?(diff<0?"#44BB66":diff>0?"#E85555":"#888"):(diff>0?"#44BB66":diff<0?"#E85555":"#888")}}>{diff>0?"+":""}{diff.toFixed(1)}</span>}
                </div>
                <div style={{display:"flex",alignItems:"center",gap:3}}>
                  <input value={form[f.key]} onChange={e=>updateField(f.key,e.target.value)}
                    inputMode="decimal" placeholder="â€”"
                    style={{flex:1,minWidth:0,padding:"7px 6px",background:"#222",border:"1px solid #333",borderRadius:8,color:"#fff",fontSize:17,fontWeight:700,outline:"none",textAlign:"center"}}/>
                  <span style={{fontSize:11,color:"#666",flexShrink:0}}>{f.unit}</span>
                </div>
              </div>
            );
          })}
        </div>

        {/* Memo */}
        <div style={{background:"#1a1a1a",borderRadius:14,padding:"12px",border:"1px solid #333",marginBottom:12}}>
          <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:8}}>
            <span style={{fontSize:14}}>ğŸ“</span>
            <span style={{fontSize:12,fontWeight:700,color:"#aaa"}}>ãƒ¡ãƒ¢</span>
          </div>
          <textarea value={form.memo} onChange={e=>updateField("memo",e.target.value)}
            placeholder="ä½“èª¿ã€é£Ÿäº‹å†…å®¹ã€æ°—ã¥ããªã©â€¦" rows={2}
            style={{width:"100%",padding:"8px 10px",background:"#222",border:"1px solid #333",borderRadius:8,color:"#fff",fontSize:14,outline:"none",lineHeight:1.5,boxSizing:"border-box"}}/>
        </div>

        {/* Save button */}
        <button onClick={handleSave} disabled={saving||!hasInput}
          style={{width:"100%",padding:"14px",borderRadius:14,border:"none",fontSize:16,fontWeight:800,cursor:hasInput?"pointer":"default",
            background:saving?"#555":hasInput?"#FFD700":"#333",color:saving?"#aaa":hasInput?"#111":"#666",
            transition:"all .2s",marginBottom:20}}>
          {saving?"ä¿å­˜ä¸­â€¦":"ğŸ’¾ æ¸¬å®šãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜"}
        </button>

        {/* History */}
        <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10}}>
          <button onClick={()=>setShowHistory(!showHistory)} style={{background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:6}}>
            <span style={{fontSize:15,fontWeight:800,color:"#ccc"}}>ğŸ“Š æ¸¬å®šå±¥æ­´</span>
            <span style={{fontSize:12,color:"#666"}}>{measurements.length}ä»¶</span>
            <span style={{color:"#666",fontSize:14,transform:showHistory?"rotate(90deg)":"none",transition:"transform .2s"}}>â€º</span>
          </button>
        </div>

        {showHistory&&measurements.length>0&&(
          <div style={{display:"flex",flexDirection:"column",gap:8}}>
            {measurements.map((m,i)=>{
              const isSelected=m.date===date;
              return(
                <div key={m.date} onClick={()=>selectDate(m.date)}
                  style={{background:isSelected?"#222":"#1a1a1a",borderRadius:14,padding:"10px 12px",border:isSelected?"1px solid #FFD70050":"1px solid #2a2a2a",cursor:"pointer"}}>
                  <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8}}>
                    <div style={{display:"flex",alignItems:"center",gap:8}}>
                      <span style={{fontSize:13,fontWeight:800,color:isSelected?"#FFD700":"#ccc"}}>{m.date}</span>
                      {m.memo&&<span style={{fontSize:10,color:"#888",background:"#2a2a2a",padding:"1px 6px",borderRadius:4}}>ğŸ“</span>}
                    </div>
                    <button onClick={(e)=>{e.stopPropagation();setConfirm(m.date)}} style={{width:28,height:28,borderRadius:8,background:"#2a2a2a",border:"1px solid #333",color:"#884444",fontSize:12,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0}}>ğŸ—‘</button>
                  </div>
                  <div style={{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:"4px 12px"}}>
                    {MFIELDS.map(f=>(
                      <div key={f.key} style={{display:"flex",alignItems:"center",gap:4,minWidth:0}}>
                        <span style={{fontSize:11,color:f.color,fontWeight:600,flexShrink:0}}>{f.label}</span>
                        <span style={{fontSize:13,fontWeight:700,color:m[f.key]?"#ddd":"#444"}}>{m[f.key]||"â€”"}</span>
                        {m[f.key]&&<span style={{fontSize:10,color:"#555"}}>{f.unit}</span>}
                      </div>
                    ))}
                  </div>
                  {m.memo&&<div style={{marginTop:6,fontSize:11,color:"#999",lineHeight:1.4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>ğŸ’¬ {m.memo}</div>}
                </div>
              );
            })}
          </div>
        )}
        {showHistory&&measurements.length===0&&(
          <div style={{padding:30,textAlign:"center",color:"#666",fontSize:14}}>ã¾ã æ¸¬å®šãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
        )}
        <div style={{height:70}}/>
      </div>
      <ConfirmDialog open={confirm!==null} message={`${confirm} ã®æ¸¬å®šãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`} onConfirm={()=>handleDelete(confirm)} onCancel={()=>setConfirm(null)}/>
    </div>
  );
}

function App(){
  const[users,setUsers]=useState(null);const[currentUser,setCurrentUser]=useState(null);
  const[menus,setMenus]=useState(null);const[comments,setComments]=useState({});const[measurements,setMeasurements]=useState([]);
  const[activeTab,setActiveTab]=useState("Home");const[sessionDate,setSessionDate]=useState(todayStr());
  const[selDay,setSelDay]=useState(null);const[menuPickerDate,setMenuPickerDate]=useState(null);
  const[syncing,setSyncing]=useState(false);const[toast,setToast]=useState(null);
  const dirtyRef=useRef(false); // track if user is actively editing
  const handleDirtyChange=useCallback((isDirty)=>{dirtyRef.current=isDirty},[]);

  // Load users from server
  useEffect(()=>{(async()=>{const r=await api.getUsers();if(r){setUsers(r.users||DEFAULT_USERS);setCurrentUser(r.current||r.users?.[0]||DEFAULT_USERS[0])}else{setUsers([...DEFAULT_USERS]);setCurrentUser(DEFAULT_USERS[0])}})()},[]);

  // Load menus + comments from server when user changes
  useEffect(()=>{if(!currentUser)return;setMenus(null);(async()=>{const r=await api.sync(currentUser);if(r){setMenus(r.menus||DC(DEFAULT_MENUS));setComments(r.comments||{});setMeasurements(r.measurements||[]);if(!r.menus){await api.saveMenus(currentUser,DC(DEFAULT_MENUS))}}else{setMenus(DC(DEFAULT_MENUS));setComments({});setMeasurements([])}})()},[currentUser]);

  // Poll server every 5 seconds for updates (from trainer/other users)
  useEffect(()=>{if(!currentUser||!menus)return;
    const iv=setInterval(async()=>{
      if(dirtyRef.current)return; // don't overwrite if user is editing
      setSyncing(true);
      const r=await api.sync(currentUser);
      if(r){
        if(r.menus)setMenus(r.menus);
        if(r.comments)setComments(r.comments);
        if(r.measurements)setMeasurements(r.measurements);
      }
      setSyncing(false);
    },15000);
    return()=>clearInterval(iv);
  },[currentUser,menus]);

  const handleMenuSave=useCallback(async(tab,draftExercises)=>{
    const saved=DC(draftExercises);
    // Update local menus immediately so UI stays consistent
    setMenus(prev=>({...prev,[tab]:saved}));
    // Save to server
    await api.saveMenuTab(currentUser,tab,saved);
    // Sync comments only (menus already updated locally)
    const r=await api.getComments(currentUser);if(r)setComments(r.comments||{});
  },[currentUser]);

  const handleSaveComment=useCallback(async(key,author,text)=>{
    await api.addComment(currentUser,key,author,text);
    const r=await api.getComments(currentUser);if(r)setComments(r.comments||{});
  },[currentUser]);

  const handleSaveMeasurement=useCallback(async(data)=>{
    try{
      const r=await api.saveMeasurement(currentUser,data);
      if(r?.measurements)setMeasurements(r.measurements);
    }catch(e){console.error("Measurement save error:",e)}
  },[currentUser]);
  const handleDeleteMeasurement=useCallback(async(date)=>{
    try{
      const r=await api.deleteMeasurement(currentUser,date);
      if(r?.measurements)setMeasurements(r.measurements);
    }catch(e){console.error("Measurement delete error:",e)}
  },[currentUser]);

  const switchUser=(u)=>{setCurrentUser(u);setActiveTab("Home");setSelDay(null)};
  const addUser=async(name)=>{await api.addUser(name);setUsers(prev=>[...prev,name]);setCurrentUser(name);setActiveTab("Home");setSelDay(null)};
  const goToMenu=(mn,date)=>{setActiveTab(mn);setSessionDate(date);setSelDay(null)};

  if(!users||!currentUser||!menus)return<div style={{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",background:"#111",color:"#fff"}}><div style={{fontSize:18,opacity:0.5}}>ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šä¸­â€¦</div></div>;

  const allTabs=["Home",...MENU_TABS,"æ¸¬å®š"];const userIdx=users.indexOf(currentUser);const userColor=USER_COLORS[userIdx%USER_COLORS.length];
  return(<div style={{background:"#111",minHeight:"100vh",color:"#eee",fontFamily:"'Noto Sans JP',-apple-system,sans-serif",paddingBottom:80}}>
    <UserBar users={users} currentUser={currentUser} onSwitch={switchUser} onAdd={addUser} syncing={syncing}/>
    {selDay?<SessionDetail dateStr={selDay} menus={menus} comments={comments} onBack={()=>setSelDay(null)} onGoToMenu={goToMenu}/>
      :activeTab==="Home"?<HomeScreen menus={menus} onGoToMenu={goToMenu} onSelectDay={ds=>setSelDay(ds)} onNewSession={ds=>setMenuPickerDate(ds)} currentUser={currentUser}/>
      :activeTab==="æ¸¬å®š"?<MeasurementScreen measurements={measurements} onSave={handleSaveMeasurement} onDelete={handleDeleteMeasurement} onDirtyChange={handleDirtyChange}/>
      :<MenuScreen menus={menus} tab={activeTab} sessionDate={sessionDate} setSessionDate={setSessionDate} onSave={handleMenuSave} comments={comments} onSaveComment={handleSaveComment} onDirtyChange={handleDirtyChange}/>}
    <MenuPickerModal open={!!menuPickerDate} dateStr={menuPickerDate} onClose={()=>setMenuPickerDate(null)} onSelect={mn=>{setSessionDate(menuPickerDate);setActiveTab(mn);setMenuPickerDate(null)}}/>
    <div style={{position:"fixed",bottom:0,left:0,right:0,zIndex:100,background:"#1a1a1a",borderTop:"1px solid #333",display:"flex",paddingBottom:"env(safe-area-inset-bottom)"}}>{allTabs.map(t=>(<button key={t} onClick={()=>{setActiveTab(t);setSelDay(null)}} style={{flex:1,minWidth:0,padding:"8px 2px 6px",background:"none",border:"none",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:1,opacity:activeTab===t?1:0.35,transition:"opacity .15s",overflow:"hidden"}}><span style={{fontSize:15}}>{t==="Home"?"ğŸ“…":MENU_EMOJI[t]}</span><span style={{fontSize:9,fontWeight:activeTab===t?800:500,color:activeTab===t?"#fff":"#888",whiteSpace:"nowrap"}}>{t==="Home"?"ãƒ›ãƒ¼ãƒ ":t}</span>{activeTab===t&&<div style={{width:14,height:2.5,borderRadius:2,background:t==="Home"?userColor:"#FFD700",marginTop:1}}/>}</button>))}</div>
  </div>);
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
